SELECT * from orders where
    orders.id = 'b3fae59d-7390-11f0-abbf-026a3238d89a';

SELECT
    product.product_code,
    product_price_master.grossPrice AS master_price,
    product_price_customer.grossPrice as custom_price,
    order_row.net_price,
    order_row.markup,
    order_row.quantity,
    order_row.discount_value,
    order_row.extra_discount,
    order_row.price_amount,
    order_row.write_at,
    order_row.read_at
FROM
    orders
    INNER JOIN order_row ON order_row.order_id = orders.id
    INNER JOIN product ON product.id = order_row.product_id

    LEFT JOIN price_list_customer ON orders.destination_id = price_list_customer.destination_id
    and price_list_customer.start_date <= CURRENT_DATE
    and price_list_customer.end_date > CURRENT_DATE

    left join product_price_customer on product_price_customer.price_list_customer_id = price_list_customer.id
    and product_price_customer.product_id = product.id
    -- AND product_price_customer.start_date = (
    --     SELECT
    --         MAX(start_date)
    --     FROM
    --         product_price_customer
    --     WHERE
    --         product_id = product.id
    --         AND start_date <= CURRENT_DATE
    --         AND end_date > CURRENT_DATE
    -- )

    LEFT JOIN product_price_master ON product_price_master.product_id = product.id
    AND product_price_master.start_date = (
        SELECT
            MAX(start_date)
        FROM
            product_price_master
        WHERE
            product_id = product.id
            AND start_date <= CURRENT_DATE
            AND end_date > CURRENT_DATE
    )
WHERE
    orders.id = 'b3fae59d-7390-11f0-abbf-026a3238d89a'
ORDER BY
    order_row.`row_number`
